version: "3"

services:
    bastion:
        image: nginx
        container_name: bastion
        ports:
            - "80"
            - "443"
        environment:
            - NGINX_HOST=samela.io
            - NGINX_PORT=80

    plex:
        image: plexinc/pms-docker:plexpass
        container_name: plex
        network_mode: host
        restart: always
        environment:
            - TZ="America/Boston"
        devices:
            - /dev/dri:/dev/dri
        volumes:
            - /share/Library:/data:rw
        restart: always

    pihole:
        container_name: pihole
        image: pihole/pihole:latest
        restart: always
        environment:
            - TZ="America/Boston"
        ports:
            - "53:53/tcp"
            - "53:53/udp"
            - "67:67/udp"
            - "8080:80/tcp"
            - "443:443/tcp"
        volumes:
            - "./etc-pihole/:/etc/pihole/"
            - "./etc-dnsmasq.d/:/etc/dnsmasq.d/"
        cap_add:
            - NET_ADMIN

    freepbx:
        container_name: freepbx
        image: tiredofit/freepbx
        ports:
        - 8081:80
        - 5060:5060/udp
        - 5061:5061/udp
        - 5160:5160/udp
        - 18000-18100:18000-18100/udp
        - 4445:4445
        volumes:
        - ./certs:/certs
        - ./data:/data
        - ./logs:/var/log
        - ./data/www:/var/www/html
        - ./db:/var/lib/mysql
        environment: 
        - ZABBIX_HOSTNAME=freepbx-app
        - RTP_START=18000
        - RTP_FINISH=18100
        - DB_EMBEDDED=TRUE
        restart: always

    rtltcp:
        container_name: rtltcp
        image: kosdk/rtl-tcp
        ports:
            - 1234:1234
        devices: 
            - /dev/bus/usb/003

    samba:
        image: joebiellik/samba-server
        volumes:
            - ./smb.conf:/etc/samba/smb.conf
            - /share:/mnt/share
        ports:
            - "137:137/udp"
            - "138:138/udp"
            - "139:139/tcp"
            - "445:445/tcp"

    transmission:
        image: gists/transmission
        container_name: transmission
        ports:
            - "9091:9091"
            - "51413:51413"
        volumes:
            - /share/temp:/data
        restart: always

    shinobi:
        image: shinobisystems/shinobi:latest-ubuntu
        container_name: shinobi
        ports:
            - "8080:8080/tcp"
        environment:
            - APP_BRANCH=dev
        volumes:
            - /dev/shm/shinobiStreams:/dev/shm/streams:rw
            - $HOME/shinobiConfig:/config:rw
            - $HOME/shinobiCustomAutoLoad:/customAutoLoad:rw
            - $HOME/shinobiDatabase:/var/lib/mysql:rw
            - $HOME/shinobiVideos:/opt/shinobi/videos:rw

